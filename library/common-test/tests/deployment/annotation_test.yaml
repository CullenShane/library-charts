suite: deployment annotation test
templates:
  - common.yaml
tests:
  - it: should pass with default values
    documentIndex: &deploymentDoc 0
    asserts:
      - hasDocuments:
          count: 2
      - isKind:
          of: Deployment
      - isNotEmpty:
          path: metadata.annotations.rollme

  - it: should pass with controller and global annotations
    documentIndex: *deploymentDoc
    set:
      some_key: some_value
      controller:
        annotations:
          controller_key: controller_value
          controller_key2: "{{ .Values.some_key }}"
      global:
        annotations:
          global_key: global_value
          global_key2: "{{ .Values.some_key }}"
    asserts:
      - equal:
          path: metadata.annotations.controller_key
          value: controller_value
      - equal:
          path: metadata.annotations.controller_key2
          value: some_value
      - equal:
          path: metadata.annotations.global_key
          value: global_value
      - equal:
          path: metadata.annotations.global_key2
          value: some_value
      - isNotEmpty:
          path: metadata.annotations.rollme

  - it: should pass with podAnnotations set
    documentIndex: *deploymentDoc
    set:
      some_key: some_value2
      podAnnotations:
        test: some_value
        test2: "{{ .Values.some_key }}"
    asserts:
      - equal:
          path: spec.template.metadata.annotations.test2
          value: some_value2
      - equal:
          path: spec.template.metadata.annotations.test
          value: some_value
