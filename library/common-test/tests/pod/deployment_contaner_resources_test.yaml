suite: deployment container resources test
templates:
  - common.yaml
tests:
  - it: should pass with default values
    asserts:
      - hasDocuments:
          count: 1
      - documentIndex: &deploymentDoc 0
        isKind:
          of: Deployment
      - equal:
          path: spec.template.spec.containers[0].resources
          value:
            limits:
              cpu: 4000m
              memory: 8Gi
            requests:
              cpu: 10m
              memory: 50Mi

  - it: should pass with changed resources
    set:
      resources:
        limits:
          cpu: 3000m
          memory: 4Gi
        requests:
          cpu: 20m
          memory: 100Mi
    asserts:
      - equal:
          documentIndex: *deploymentDoc
          path: spec.template.spec.containers[0].resources
          value:
            limits:
              cpu: 3000m
              memory: 4Gi
            requests:
              cpu: 20m
              memory: 100Mi

  - it: should pass with changed resources and added GPU
    set:
      scaleGPU:
        gpu: 1
      resources:
        limits:
          cpu: 3000m
          memory: 4Gi
        requests:
          cpu: 20m
          memory: 100Mi
    asserts:
      - equal:
          documentIndex: *deploymentDoc
          path: spec.template.spec.containers[0].resources
          value:
            limits:
              cpu: 3000m
              memory: 4Gi
              gpu: 1
            requests:
              cpu: 20m
              memory: 100Mi

  - it: should pass with empty resources
    set:
      scaleGPU:
        gpu:
      resources:
        limits:
          cpu:
          memory:
        requests:
          cpu:
          memory:
    asserts:
      - isNull:
          documentIndex: *deploymentDoc
          path: spec.template.spec.containers[0].resources

  - it: should pass with only limits.cpu defined
    set:
      scaleGPU:
        gpu:
      resources:
        limits:
          cpu: 3000m
          memory:
        requests:
          cpu:
          memory:
    asserts:
      - equal:
          documentIndex: *deploymentDoc
          path: spec.template.spec.containers[0].resources
          value:
            limits:
              cpu: 3000m

  - it: should pass with only limits.memory defined
    set:
      scaleGPU:
        gpu:
      resources:
        limits:
          cpu:
          memory: 4Gi
        requests:
          cpu:
          memory:
    asserts:
      - equal:
          documentIndex: *deploymentDoc
          path: spec.template.spec.containers[0].resources
          value:
            limits:
              memory: 4Gi

  - it: should pass with only requests.cpu defined
    set:
      scaleGPU:
        gpu:
      resources:
        limits:
          cpu:
          memory:
        requests:
          cpu: 10m
          memory:
    asserts:
      - equal:
          documentIndex: *deploymentDoc
          path: spec.template.spec.containers[0].resources
          value:
            requests:
              cpu: 10m

  - it: should pass with only requests.memory defined
    set:
      scaleGPU:
        gpu:
      resources:
        limits:
          cpu:
          memory:
        requests:
          cpu:
          memory: 50Mi
    asserts:
      - equal:
          documentIndex: *deploymentDoc
          path: spec.template.spec.containers[0].resources
          value:
            requests:
              memory: 50Mi

  - it: should pass with only limits.gpu defined
    set:
      scaleGPU:
        gpu: 1
      resources:
        limits:
          cpu:
          memory:
        requests:
          cpu:
          memory:
    asserts:
      - equal:
          documentIndex: *deploymentDoc
          path: spec.template.spec.containers[0].resources
          value:
            limits:
              gpu: 1

  - it: should pass with only requests defined
    set:
      scaleGPU:
        gpu:
      resources:
        limits:
          cpu:
          memory:
        requests:
          cpu: 10m
          memory: 50Mi
    asserts:
      - equal:
          documentIndex: *deploymentDoc
          path: spec.template.spec.containers[0].resources
          value:
            requests:
              cpu: 10m
              memory: 50Mi

  - it: should pass with only limits defined
    set:
      scaleGPU:
        gpu:
      resources:
        limits:
          cpu: 3000m
          memory: 4Gi
        requests:
          cpu:
          memory:
    asserts:
      - equal:
          documentIndex: *deploymentDoc
          path: spec.template.spec.containers[0].resources
          value:
            limits:
              cpu: 3000m
              memory: 4Gi

  - it: should pass with only gpu defined
    set:
      scaleGPU:
        gpu: 1
      resources:
        limits:
          cpu:
          memory:
        requests:
          cpu:
          memory:
    asserts:
      - equal:
          documentIndex: *deploymentDoc
          path: spec.template.spec.containers[0].resources
          value:
            limits:
              gpu: 1
