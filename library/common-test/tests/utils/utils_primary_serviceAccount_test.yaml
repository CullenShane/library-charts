
suite: primary serviceAccount utils test
templates:
  - common.yaml
tests:
  - it: should pass with default values
    documentIndex: &serviceAccountDoc 0
    asserts:
      - hasDocuments:
          count: 1

  - it: should fail with more than 1 primary serviceAccounts
    documentIndex: *serviceAccountDoc
    set:
      serviceAccount:
        main:
          enabled: true
          primary: true
        other:
          enabled: true
          primary: true
    asserts:
      - failedTemplate:
          errorMessage: More than one serviceAccounts are set as primary. This is not supported.

  - it: should pass with no serviceAccount set as primary
    documentIndex: *serviceAccountDoc
    set:
      serviceAccount:
        main:
          enabled: true
          primary: false
    asserts:
      - isKind:
          of: ServiceAccount

  - it: should pass with main serviceAccount set as primary and other not
    documentIndex: *serviceAccountDoc
    set:
      serviceAccount:
        main:
          enabled: true
          primary: true
        other:
          enabled: true
          primary: false
    asserts:
      - isKind:
          of: ServiceAccount

  - it: should pass with different serviceAccount set as primary
    documentIndex: *serviceAccountDoc
    set:
      serviceAccount:
        main:
          enabled: true
          primary: false
        other:
          enabled: true
          primary: true
    asserts:
      - isKind:
          of: ServiceAccount
